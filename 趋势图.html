<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>趋势图</title>
	<style>
		body, div, ul, li, span, p,
		table, th, td, tr {
			margin: 0;
			padding: 0;
		}
		li {
			list-style: none;
		}

		.trend-mod {
			width: 100vw;
			height: 100vh;
			position: relative;
			z-index: 1;
			overflow: hidden;
		}
		.trend-aside-y {
			top: 0;
			bottom: 0;
			border-right: 1px solid;

			width: 120px;
			text-align: right;
			padding-bottom: 61px;
		}
		.trend-aside-y ul {
			height: 100%;
			padding: 0 10px;
			overflow: hidden;
		}
		.trend-aside-x {
			height: 60px;

			bottom: 0;
			right: 0;
			padding-left: 120px;
			border-top: 1px solid;
		}
		.ul-box {
			width: 100%;
			overflow: hidden;
		}
		.trend-aside-x ul {
			font-size: 0;

		}
		.trend-aside-x ul li {
			display: inline-block;
			font-size: 14px;
			text-align: center;
		}
		.trend-aside-x,
		.trend-aside-y {
			position: absolute;
			left: 0;
			z-index: 5;
			box-sizing: border-box;
			border-color:  #aaa;
		}

		.trend-inner {
			width: 100%;
			height: 100%;
			padding: 0 0 60px 120px;
			box-sizing: border-box;
		}
		.trend-main {
			width: 100%;
			height: 100%;
			cursor: move;
			overflow: hidden;
		}

		table, td {
			text-align: center;
			border-collapse: collapse;
			box-sizing: border-box;
		}
		td {
			border: 1px dotted #ddd;
		}
		tr:first-child td {
			border-top-color: transparent;
		}
		tr:last-child td {
			border-bottom-color: transparent;
		}
		tr td:first-child {
			border-left: 0;
		}
		tr td:last-child {
			border-right: 0;
		}
		
		/* 设置y 轴和表格的高度 */
		.trend-aside-y li,
		.trend-main td {
			height: 30px;
		}
		.trend-aside-y li {
			line-height: 30px;
		}
		/* 设置x轴样式 */
		.trend-aside-x ul li {
			padding: 10px 0;
		}

	</style>
</head>
<body>
	<div id="trend-mod" class="trend-mod"></div>

	<script>

		var x = [];
		for (var i = 1; i < 13; i++) {
			x.push('2016年'+i+'月')
		}

		var y = [];
		for (var i = 0; i < 50; i++) {
			y.push('列 '+(i+1) )
		}

		var tableDatas = [];

		for (var tr = 0; tr < 50; tr++) {
			tableDatas[tr] = [];
			for (var td = 1; td < 13; td++) {
				tableDatas[tr].push(tr + ' - ' + td)
			}
		}
		console.log(x, y, tableDatas);


var trendCharts = {
	makeTrend: function (option) {
		var trendHTML = '';
		var x_w = option.x.css.width * option.x.data.length;

		var getArrHtml = function(arr) {
			var html = '';
			for (var i = 0, len = arr.length; i < len; i++) {
				html += '<li>' + arr[i] + '</li>'
			}

			return html;
		}

		// 生成 y 轴
		trendHTML += '<div class="trend-aside-y">'
		trendHTML += '<ul id="aside-y-ul">' + getArrHtml(option.y.data)
		trendHTML += '</ul></div>';

		// 生成 x 轴
		trendHTML += function() {
			var x = option.x;
			var xHtml = '<div class="trend-aside-x">';
			xHtml += '<div id="aside-x-ul" class="ul-box">';
			xHtml += '<ul style="width:'+ x_w +'px">';

			for (var i = 0, len = x.data.length; i < len; i++) {
				xHtml += '<li style="width:'+ x.css.width +'px">' + x.data[i] + '</li>'
			}

			xHtml += '</ul></div></div>'
			return xHtml
		}()

		// 生成主体表格
		trendHTML += function() {
			var td_w = x_w / option.x.data.length;
			var tableData = option.table.data;

			var _table = '<div class="trend-inner">';
			_table += '<div id="trend-box" class="trend-main">';
	 		_table += '<table style="width:'+ x_w +'px">';


	 		if (option.table.dataType === 'array') {

				for (var i = 0, tlen = tableData.length; i< tlen; i++ ) {
					_table += '<tr>';

					for (var td = 0, len = tableData[i].length; td < len; td++) {
						_table += '<td style="width:'+td_w+'px">' + tableData[i][td] + '</td>'
					}

					_table += '</tr>';
				}
	 			
	 		} 
	 		else if (option.table.dataType === 'object') {
	 			option.y.data.forEach(function(yval) {
	 				_table += '<tr>';

 					option.x.data.forEach(function(xval) {
		 				_table += '<td style="width:'+td_w+'px">';

			 			tableData.forEach(function(val) {

			 				if (val.y === yval && val.x === xval){

	 							_table += val.inner;
			 				}
	 					})
		 				_table == '</td>';
		 			})

		 			_table += '</tr>';
	 			})
	 		}
			return _table  += '</table></div></div>'
		}();

		document.getElementById(option.id).innerHTML = trendHTML;

	},
	event: function() {
		var mainBox = document.getElementById('trend-box');
		var asideY = document.getElementById('aside-y-ul');
		var asideX = document.getElementById('aside-x-ul');
		var positions = {};
		var isMouseDown = false;

		// 定位y轴和内容从底部开始
		asideY.scrollTop = mainBox.scrollTop = asideY.clientHeight;

		mainBox.addEventListener('mousedown', function(e) {
			positions.page = {};
			positions.page.x = e.pageX;
			positions.page.y = e.pageY;

			positions.scroll = {};
			positions.scroll.top = mainBox.scrollTop;
			positions.scroll.left = mainBox.scrollLeft;
		})
		mainBox.addEventListener('mousemove', function(e) {

			if (e.buttons) {
				
				e.preventDefault();

				var moveY = positions.page.y -e.pageY + positions.scroll.top;
				var moveX =positions.page.x - e.pageX + positions.scroll.left;
				mainBox.scrollTop = moveY;
				asideY.scrollTop = moveY;

				mainBox.scrollLeft = moveX;
				asideX.scrollLeft = moveX;

			}
		}, false);
	},
	init: function(option){
		this.makeTrend(option);
		this.event()
	}
}

	// 示例 1
	// trendCharts.init({
	// 	id: 'trend-mod',
	// 	x: {
	// 		data: x,
	// 		css: {
	// 			width: 200,
	// 			padding: 10
				
	// 		}
	// 	},
	// 	y: {
	// 		data: y
	// 	},
	// 	table: {
	// 		dataType: 'array',
	// 		data: tableDatas
	// 	}
	// } )


	// 示例 2
	trendCharts.init({
		id: 'trend-mod',
		x: {
			data: [
				'2016年4月',
				'2016年5月',
				'2016年6月'
			],
			css: {
				width: 200
			}
		},
		y: {
			data: [
				'卖淫嫖娼事件',
				'黑恶势力事件',
				'消防安全事件',
				'安全生产事件',
				'环境污染事件',
				'食品卫生事件',
				'公共安全事件',
				'盗窃事件',
				'赌博时间',
				'毒品事件',
				'抢夺事件',
				'抢劫事件'
			]
		},
		table: {
			dataType: 'object',
			data: [
				{
					x: '2016年4月',
					y: '黑恶势力事件',
					inner: '<p class="saveEvent-tag up-saveEvent-tag"><span>Top 1</span><span>23.58%<i class="minIco-toTop"></i></p>'
				},
				{
					x: '2016年5月',
					y: '环境污染事件',
					inner: '<p class="saveEvent-tag down-saveEvent-tag"><span>Top 1</span><span>3.58%<i class="minIco-toDown"></i></p>'
				},
				{
					x: '2016年6月',
					y: '食品卫生事件',
					inner: '<p class="saveEvent-tag up-saveEvent-tag"><span>Top 1</span><span>33.58%<i class="minIco-toTop"></i></p>'
				}
			]
		}
	} );

	</script>
</body>
</html>